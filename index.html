<!doctype html>
<html lang="mr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Farmer Cup 2026 — प्रोफाइल फ्रेम जनरेटर</title>
  <style>
    :root{
      --bg:#f7f4ef; --card:#fff; --soft:#fbf8f2; --line:#e7e0d6;
      --text:#1b1b1b; --muted:#5a5a5a; --accent:#6b5b4b; --accent2:#8a7a66;
      --shadow:0 10px 30px rgba(50,40,25,0.10); --radius:22px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Noto Sans Devanagari",Arial,sans-serif;background:var(--bg);color:var(--text)}
    .screen{min-height:100vh;display:flex;justify-content:center;align-items:stretch;padding:10px 10px 14px}
    .card{width:100%;max-width:680px;height:100vh;background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px 14px 16px;display:grid;gap:10px;grid-template-rows:auto auto auto auto auto auto}
    h1{margin:2px 0 0;font-size:clamp(22px,3.1vh,30px);line-height:1.12;font-weight:900}
    .instructions{margin:0;padding:12px;border:1px solid var(--line);border-radius:18px;background:var(--soft);font-size:clamp(18px,2.5vh,24px);line-height:1.6;font-weight:750}
    .label{font-size:clamp(16px,2.1vh,20px);font-weight:900;margin:0}
    .fieldBlock{display:grid;gap:10px}
    input[type="text"],select{width:100%;padding:14px 12px;border-radius:16px;border:1px solid var(--line);background:#fff;font-size:16px;font-weight:700;outline:none}
    input::placeholder{color:#999}
    input[type="file"]{display:none}
    .uploadRow{display:grid;gap:10px}
    .uploadBtn{width:100%;padding:16px;border-radius:18px;border:1px solid var(--line);background:#fff;color:var(--accent);font-weight:950;font-size:clamp(16px,2.2vh,20px);box-shadow:0 4px 14px rgba(50,40,25,0.08)}
    .fileName{font-size:clamp(13px,1.8vh,16px);color:var(--muted);padding:10px 12px;border-radius:14px;background:#f3efe8;border:1px solid var(--line);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .zoomBlock{padding:12px;background:var(--soft);border:1px solid var(--line);border-radius:18px}
    .zoomLabel{display:flex;justify-content:space-between;align-items:center;font-size:clamp(16px,2.0vh,20px);font-weight:900;margin-bottom:8px}
    .hint{font-size:12px;font-weight:700;color:var(--muted)}
    input[type="range"]{width:100%;height:46px;accent-color:var(--accent2)}
    .previewWrap{width:100%;border-radius:20px;border:1px solid var(--line);background:#fff;overflow:hidden;display:flex;align-items:center;justify-content:center;height:min(44vh,420px)}
    .previewInner{height:100%;aspect-ratio:1/1;width:auto}
    canvas{width:100%;height:100%;display:block;touch-action:none}
    .btnRow{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:2px}
    button{padding:16px;border-radius:18px;border:none;font-weight:950;font-size:clamp(16px,2.2vh,20px)}
    .primary{background:linear-gradient(180deg,#8a7a66,#6b5b4b);color:#fff}
    .primary:disabled{background:#bcbcbc}
    .secondary{background:#efe7dc;color:#3a332a;border:1px solid var(--line)}
    .errorBox{display:none;padding:10px 12px;border-radius:14px;border:1px solid #ffd1d1;background:#fff3f3;color:#9b0b0b;font-weight:800;line-height:1.4}
    .errorBox.show{display:block}
    @media (max-height:730px){.card{gap:8px}.instructions{font-size:clamp(16px,2.2vh,20px);padding:10px}.zoomBlock{padding:10px}.uploadBtn,button{padding:14px}.previewWrap{height:min(38vh,340px)}}
  </style>
</head>
<body>
  <div class="screen">
    <div class="card">
      <h1>I am proud to be a part of the Farmer Cup 2026</h1>

      <div class="instructions">
        1) तुमचा फोटो <b>अपलोड</b> करा<br>
        2) फोटो <b>हलवा</b> आणि <b>Zoom</b> करून फ्रेममध्ये बसवा<br>
        3) <b>नाव</b> लिहा आणि <b>पद</b> निवडा<br>
        4) <b>डाउनलोड</b> करा आणि शेअर करा
      </div>

      <div class="errorBox" id="errorBox"></div>

      <div class="fieldBlock">
        <div>
          <div class="label">तुमचं नाव</div>
          <input id="name" type="text" placeholder="उदा. रोहिणी पाटील" maxlength="40" />
        </div>

        <div>
          <div class="label">तुमचं पद (Designation) निवडा</div>
          <select id="designation">
            <option value="">— पद निवडा —</option>
            <option value="Field Officer">Field Officer</option>
            <option value="Rajya Samanvayak">Rajya Samanvayak</option>
            <option value="Vibhagiy Samanvayak">Vibhagiy Samanvayak</option>
          </select>
        </div>
      </div>

      <div class="uploadRow">
        <div class="label">फोटो अपलोड</div>
        <button class="uploadBtn" id="uploadBtn" type="button">फोटो गॅलरीतून निवडा</button>
        <div class="fileName" id="fileName">अद्याप फोटो निवडलेला नाही</div>
        <input id="photoInput" type="file" accept="image/*" />
      </div>

      <div class="zoomBlock">
        <div class="zoomLabel">
          <span>Zoom</span>
          <span class="hint">फोटो बोटाने हलवा</span>
        </div>
        <input id="zoomSlider" type="range" min="1" max="3" step="0.01" value="1.2" />
      </div>

      <div class="previewWrap">
        <div class="previewInner">
          <canvas id="canvas" width="1080" height="1080"></canvas>
        </div>
      </div>

      <div class="btnRow">
        <button class="secondary" id="resetBtn" type="button">रीसेट</button>
        <button class="primary" id="downloadBtn" type="button" disabled>डाउनलोड</button>
      </div>
    </div>
  </div>

<script>
  // === Put frame.png in the SAME folder as index.html in GitHub repo root ===
  // cache-busting helps when you update the frame later
  const FRAME_PATH = "./frame.png?v=1";

  // Photo cutout (edit to match your frame)
  const CUTOUT = { shape:"circle", cx:540, cy:520, r:340 };

  // Text placement (edit to match your frame)
  const TEXT_AREA = { nameY: 935, desgY: 995, maxWidth: 920 };

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const nameInput = document.getElementById("name");
  const designationEl = document.getElementById("designation");

  const photoInput = document.getElementById("photoInput");
  const uploadBtn = document.getElementById("uploadBtn");
  const fileNameEl = document.getElementById("fileName");

  const zoomSlider = document.getElementById("zoomSlider");
  const downloadBtn = document.getElementById("downloadBtn");
  const resetBtn = document.getElementById("resetBtn");

  const errorBox = document.getElementById("errorBox");

  const frameImg = new Image();
  // Important for Pages: same-origin is fine; keep default.
  frameImg.src = FRAME_PATH;

  let frameLoaded = false;
  let userImg = null;

  let scale = parseFloat(zoomSlider.value);
  let offsetX = CUTOUT.cx;
  let offsetY = CUTOUT.cy;

  let dragging = false;
  let lastX = 0;
  let lastY = 0;

  function showError(msg){
    errorBox.textContent = msg;
    errorBox.classList.add("show");
  }
  function clearError(){
    errorBox.classList.remove("show");
    errorBox.textContent = "";
  }

  function drawBackground(){
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0,0,1080,1080);
  }

  function clipCircle(){
    ctx.beginPath();
    ctx.arc(CUTOUT.cx, CUTOUT.cy, CUTOUT.r, 0, Math.PI*2);
    ctx.closePath();
    ctx.clip();
  }

  function drawUserPhoto(){
    if(!userImg) return;

    ctx.save();
    clipCircle();

    const iw = userImg.width, ih = userImg.height;
    const target = CUTOUT.r * 2;

    const base = Math.max(target/iw, target/ih);
    const s = base * scale;

    const dw = iw * s;
    const dh = ih * s;

    ctx.drawImage(userImg, offsetX - dw/2, offsetY - dh/2, dw, dh);
    ctx.restore();
  }

  function fitText(text, x, y, maxWidth, startSize, minSize, weight){
    let size = startSize;
    while(size >= minSize){
      ctx.font = `${weight} ${size}px system-ui, -apple-system, "Noto Sans Devanagari", Arial, sans-serif`;
      if(ctx.measureText(text).width <= maxWidth) break;
      size -= 2;
    }
    ctx.fillText(text, x, y);
  }

  function drawTexts(){
    const name = (nameInput.value || "").trim();
    const desg = (designationEl.value || "").trim();
    if(!name && !desg) return;

    ctx.save();
    ctx.textAlign = "center";
    ctx.fillStyle = "#1b1b1b";
    ctx.shadowColor = "rgba(0,0,0,0.18)";
    ctx.shadowBlur = 8;
    ctx.shadowOffsetY = 2;

    if(name){
      fitText(name, 540, TEXT_AREA.nameY, TEXT_AREA.maxWidth, 64, 40, 900);
    }
    if(desg){
      fitText(desg.toUpperCase(), 540, TEXT_AREA.desgY, TEXT_AREA.maxWidth, 34, 22, 800);
    }
    ctx.restore();
  }

  function drawFrame(){
    if(!frameLoaded) return;
    ctx.drawImage(frameImg, 0, 0, 1080, 1080);
  }

  function render(){
    drawBackground();
    drawUserPhoto();
    drawFrame();   // frame overlay
    drawTexts();   // name/designation on top of frame
  }

  frameImg.onload = () => {
    frameLoaded = true;
    clearError();
    render();
    // Enable download if photo already selected
    if(userImg) downloadBtn.disabled = false;
  };

  frameImg.onerror = () => {
    frameLoaded = false;
    showError("फ्रेम लोड झाली नाही ❌ कृपया repo root मध्ये 'frame.png' (exact name) अपलोड आहे का ते तपासा.");
    render();
  };

  uploadBtn.onclick = () => photoInput.click();

  photoInput.onchange = () => {
    const file = photoInput.files && photoInput.files[0];
    if(!file) return;

    fileNameEl.textContent = file.name;

    const img = new Image();
    img.onload = () => {
      userImg = img;
      offsetX = CUTOUT.cx;
      offsetY = CUTOUT.cy;
      render();
      // enable download only if frame is loaded too
      downloadBtn.disabled = !frameLoaded;
      if(!frameLoaded){
        showError("फोटो लोड झाला ✅ पण फ्रेम लोड झाली नाही. 'frame.png' URL उघडून तपासा.");
      }
    };
    img.src = URL.createObjectURL(file);
  };

  zoomSlider.oninput = () => {
    scale = parseFloat(zoomSlider.value);
    render();
  };

  nameInput.oninput = render;
  designationEl.onchange = render;

  resetBtn.onclick = () => {
    nameInput.value = "";
    designationEl.value = "";
    photoInput.value = "";
    fileNameEl.textContent = "अद्याप फोटो निवडलेला नाही";
    userImg = null;
    scale = 1.2;
    zoomSlider.value = "1.2";
    offsetX = CUTOUT.cx;
    offsetY = CUTOUT.cy;
    downloadBtn.disabled = true;
    clearError();
    render();
  };

  downloadBtn.onclick = () => {
    if(!frameLoaded){
      showError("डाउनलोड करता येत नाही ❌ फ्रेम लोड झालेली नाही. 'frame.png' तपासा.");
      return;
    }
    const a = document.createElement("a");
    a.download = "farmer_cup_2026_badge.png";
    a.href = canvas.toDataURL("image/png");
    a.click();
  };

  canvas.onpointerdown = (e) => {
    if(!userImg) return;
    dragging = true;
    lastX = e.clientX;
    lastY = e.clientY;
    canvas.setPointerCapture(e.pointerId);
  };

  canvas.onpointermove = (e) => {
    if(!dragging || !userImg) return;
    const rect = canvas.getBoundingClientRect();
    const sx = 1080 / rect.width;
    const sy = 1080 / rect.height;

    offsetX += (e.clientX - lastX) * sx;
    offsetY += (e.clientY - lastY) * sy;

    lastX = e.clientX;
    lastY = e.clientY;

    render();
  };

  canvas.onpointerup = () => dragging = false;
  canvas.onpointercancel = () => dragging = false;

  // initial draw
  render();
</script>
</body>
</html>
